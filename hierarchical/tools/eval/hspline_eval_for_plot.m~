
for ilev = 1:hmsh.nlevels % Active levels
    nel_old = nel+1;
    nel = nel + hmsh.nel_per_level(ilev);
    ndofs = ndofs + ndof_per_level(ilev);
    dofs = 1:ndofs; % Active dofs from level 1 to ilev, in the numbering of the hierarchical space, whatever it is
    
    if (hmsh.msh_lev{ilev}.nel ~= 0)
        
        
        if (strcmpi (option, 'value'))
            [eu, F] = sp_eval_msh_old (C{ilev}*u(dofs), sp_level, msh_level);
            U(:,nel_old:nel) = eu;
        elseif (strcmpi (option, 'gradient'))
            [eu, F] = sp_eval_grad_msh_old (C{ilev}*u(dofs), sp_level, msh_level);
            U(:,:,nel_old:nel) = eu;
        elseif (strcmpi (option, 'laplacian'))
            [eu, F] = sp_eval_lapl_msh_old (C{ilev}*u(dofs), sp_level, msh_level);
            U(:,nel_old:nel) = eu;
        end
        
    end
end


